ПАМЯТКА ПО УСТАНОВКЕ (CR)
КОДИРОВКА: UTF-8
==============================================

1) Поиск портов
---------------
TBOX     (термоконтроль/лазер):     tbox = GetTBOX()
CLOCKGEN (тактогенератор):          clkg = GetCLOCKGEN()

2) Главные регистры (сырые «попугаи»)
-------------------------------------
[TBOX]
- r0   — установка температуры лазера (попугаи). Читать: ComGet(tbox, 0). Писать: ComSet(tbox, 0, <u_set>)
- r20  — реальная температура лазера (попугаи). Читать: ComGet(tbox, 20).
- r30  — реальная температура установки (попугаи). Читать: ComGet(tbox, 30).
- r61  — текущие показания/ошибка температуры (если поддерживается): ComGet(tbox, 61)
- r60  — pump (накачка)
- r71  — APD2
- r73  — APD1
- r80  — «декада» шага установки температуры (см. п.5)

[CLOCKGEN]
- r50  — imp (длина импульса, «дискреты»)
- r51  — режим (обычно 0)
- r52  — delay (задержка, «дискреты»)
- r53  — ScanRate (частота повторения), Гц
- r56  — RR-1 (предделитель такта): 0→200 МГц, 1→100 МГц, …
         Реальная Fs АЦП: Fs = 200e6 / (RR-1 + 1)

3) Базовые команды (без хелперов)
---------------------------------
- Прочитать установку температуры (попугаи):         ComGet(tbox, 0)
- Поставить установку температуры (попугаи):         ComSet(tbox, 0, <u_set>)
- Прочитать текущую «температуру/ошибку»:            ComGet(tbox, 61)

- Прочитать длину импульса (дискреты):               ComGet(clkg, 50)
- Поставить длину импульса (дискреты):               ComSet(clkg, 50, <imp>)
- Режим (как в старых скриптах):                     ComSet(clkg, 51, 0)
- Задержка импульса (дискреты):                      ComGet/ComSet(clkg, 52, <delay>)
- Частота повторения, Гц:                            ComGet/ComSet(clkg, 53, <Hz>)
- Прочитать RR-1 и вычислить Fs:                     rr1 = sscanf(ComGet(clkg,56), 'D %*d %d');  Fs = 200e6/(rr1+1)

4) Шаг по дальности для одного отсчёта АЦП (n_eff = 1.468)
----------------------------------------------------------
Формула: dz = c / (2 * n_eff * Fs), где c = 299792458 м/с.

Готовые значения:
- Fs = 200 МГц  → dz ≈ 0.51055 м на отсчёт
- Fs = 100 МГц  → dz ≈ 1.02109 м на отсчёт

Примеры:
- imp = 20, RR-1=1 (Fs=100 МГц)  → длина импульса ≈ 20 * 1.02109 ≈ 20.42 м
- imp = 20, RR-1=0 (Fs=200 МГц)  → длина импульса ≈ 20 * 0.51055 ≈ 10.21 м

Перевод дальности окна L в число отсчётов:
- segSize = ceil(L / dz)

5) «Попугаи» температуры и влияние r80
--------------------------------------
Эмпирика (по установке):
- при r80 = 3: 1 попугай = 0.0004 °C
- при r80 = 4: 1 попугай = 0.0002 °C (в 2 раза мельче)

Удобная формула:
- 1 попугай = 0.0004 * 2^(3 - r80) °C

Сдвиг длины волны лазера: 0.09 нм/°C
- при r80 = 3: Δλ за 1 попугай ≈ 0.09 * 0.0004 = 0.000036 нм = 0.036 пм
- при r80 = 4: Δλ за 1 попугай ≈ 0.09 * 0.0002 = 0.000018 нм = 0.018 пм

6) Типовая последовательность
-----------------------------
- Настроить импульс:
    ComSet(clkg, 51, 0)
    ComSet(clkg, 50, <imp>)
    (при необходимости: ComSet(clkg, 52, <delay>), ComSet(clkg, 53, <Hz>))
- Установить установку температуры (попугаи):
    ComSet(tbox, 0, <u_set>)
- Проверка:
    ComGet(tbox, 0) и ComGet(tbox, 61)

7) Примечания
-------------
- Меняйте значения маленькими шагами и всегда проверяйте ComGet после ComSet.
- Если изменили r80, помните: «цена деления» в попугаях меняется в 2 раза.
- Для графиков дальности всегда используйте реальную Fs из clkg r56.
